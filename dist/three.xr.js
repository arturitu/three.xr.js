!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.WebXRUtils=t.WebXRManager=void 0;var i=n(1),o=r(i),a=n(2),s=r(a);n(3),t.WebXRManager=o.default,t.WebXRUtils=s.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),THREE.WebXRManager=function(e,t,n,r,i){function o(e){var t=this,n=(this.session.requestFrame(a),e.getViewPose(e.getCoordinateSystem(XRCoordinateSystem.HEAD_MODEL)));!1===l&&(l=!0,e.findFloorAnchor("first-floor-anchor").then(function(e){if(null===e)return void console.error("could not find the floor anchor");t.addAnchoredNode(e,c)}).catch(function(e){console.error("error finding the floor anchor",e)}));var r=!0,o=!1,s=void 0;try{for(var u,h=f[Symbol.iterator]();!(r=(u=h.next()).done);r=!0){var d=u.value;this.updateNodeFromAnchorOffset(e,d.node,d.anchorOffset)}}catch(e){o=!0,s=e}finally{try{!r&&h.return&&h.return()}finally{if(o)throw s}}if(this.updateScene(i,e),this.renderer.autoClear=!1,this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.clear(),this.renderer.xr.sessionActive){var _=!0,y=!1,p=void 0;try{for(var v,w=e.views[Symbol.iterator]();!(_=(v=w.next()).done);_=!0){var m=v.value;this.camera.projectionMatrix.fromArray(m.projectionMatrix),this.camera.parent&&"Scene"!==this.camera.parent.type?(this.camera.parent.matrixAutoUpdate=!1,this.camera.parent.matrix.fromArray(n.poseModelMatrix),this.camera.parent.updateMatrixWorld(!0)):(this.camera.matrixAutoUpdate=!1,this.camera.matrix.fromArray(n.poseModelMatrix),this.camera.updateMatrixWorld(!0)),this.renderer.clearDepth();var b=m.getViewport(this.session.baseLayer);this.renderer.setViewport(b.x/window.devicePixelRatio,b.y/window.devicePixelRatio,b.width/window.devicePixelRatio,b.height/window.devicePixelRatio),this.doRender()}}catch(e){y=!0,p=e}finally{try{!_&&w.return&&w.return()}finally{if(y)throw p}}}else this.camera.parent&&"Scene"!==this.camera.parent.type?(this.camera.parent.matrixAutoUpdate=!1,this.camera.parent.matrix=new THREE.Matrix4,this.camera.parent.updateMatrixWorld(!0)):(this.camera.matrix=new THREE.Matrix4,this.camera.updateMatrixWorld(!0)),this.renderer.clearDepth(),this.renderer.setViewport(0,0,window.innerWidth,window.innerHeight),this.doRender()}this.renderer=t,this.camera=n,this.scene=r;var a=o.bind(this),s=e,u=null,l=!1,c=new THREE.Group,f=[];this.getDisplays=function(){return s},this.getDisplay=function(){return u},this.session=null,this.startSession=function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r={exclusive:t,type:t?XRSession.REALITY:XRSession.AUGMENTATION};setTimeout(function(){var t=!0,i=!1,o=void 0;try{for(var a,l=s[Symbol.iterator]();!(t=(a=l.next()).done);t=!0){var c=a.value;if(c.supportsSession(r)){u=c;break}}}catch(e){i=!0,o=e}finally{try{!t&&l.return&&l.return()}finally{if(i)throw o}}if(null===u)return void console.error("Could not find a display for this type of session");u.requestSession(r).then(function(t){e.session=t,e.session.depthNear=.05,e.session.depthFar=1e3,e.session.addEventListener("focus",function(t){e.handleSessionFocus(t)}),e.session.addEventListener("blur",function(t){e.handleSessionBlur(t)}),e.session.addEventListener("end",function(t){e.handleSessionEnded(t)}),n&&e.startPresenting()}).catch(function(e){console.error("Error requesting session",e)})},1e3)},this.handleSessionFocus=function(e){console.log("handleSessionFocus")},this.handleSessionBlur=function(e){console.log("handleSessionBlur")},this.handleSessionEnded=function(e){console.log("handleSessionEnded")},this.handleLayerFocus=function(e){console.log("handleLayerFocus")},this.handleLayerBlur=function(e){console.log("handleLayerBlur")},this.updateScene=function(e,t){e(t)},this.startPresenting=function(){var e=this;if(null===this.session)throw console.error("Can not start presenting without a session"),new Error("Can not start presenting without a session");this.renderer.xr.sessionActive=!0,this.session.baseLayer=new XRWebGLLayer(this.session,t.context),this.session.baseLayer.addEventListener("focus",function(t){e.handleLayerFocus(t)}),this.session.baseLayer.addEventListener("blur",function(t){e.handleLayerBlur(t)}),this.session.requestFrame(a)},this.stopPresenting=function(){this.renderer.xr.sessionActive=!1},this.doRender=function(){this.renderer.render(this.scene,this.camera)},this.addAnchoredNode=function(e,t){f.push({anchorOffset:e,node:t}),this.scene.add(t)},this.updateNodeFromAnchorOffset=function(e,t,n){var r=e.getAnchor(n.anchorUID);if(null===r)return void console.error("Unknown anchor uid",n.anchorUID);t.matrixAutoUpdate=!1;var i=n.getTransformedCoordinates(r);i.coordinateSystem.type===XRCoordinateSystem.TRACKER?t.matrix.fromArray(i.poseMatrix):t.matrix.fromArray(i.getTransformedCoordinates(e.getCoordinateSystem(XRCoordinateSystem.TRACKER)).poseMatrix),t.updateMatrixWorld(!0)}},t.default=THREE.WebXRManager},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),THREE.WebXRUtils={getDisplays:function(){return new Promise(function(e,t){if(!navigator.XR)return console.log("WebXR polyfill is not found"),void e(null);navigator.XR.getDisplays().then(function(t){if(0==t.length)return console.log("No displays are available"),void e(null);e(t)}).catch(function(t){console.error("Error getting XR displays",t),e(null)})})}},t.default=THREE.WebXRUtils},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=17)}([function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(1),a=function(e){return e&&e.__esModule?e:{default:e}}(o),s=function(){function e(){r(this,e)}return i(e,null,[{key:"mat4_generateIdentity",value:function(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},{key:"mat4_get_position",value:function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}},{key:"mat4_get_rotation",value:function(e,t){var n=new a.default;return n.setFromRotationMatrix(t),e[0]=n.x,e[1]=n.y,e[2]=n.z,e[3]=n.w,e}},{key:"mat4_eyeView",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Float32Array([0,0,0]);e.mat4_translate(t,n,r),e.mat4_invert(t,t)}},{key:"mat4_perspectiveFromFieldOfView",value:function(t,n,r,i){var o=Math.tan(n.upDegrees*e.PI_OVER_180),a=Math.tan(n.downDegrees*e.PI_OVER_180),s=Math.tan(n.leftDegrees*e.PI_OVER_180),u=Math.tan(n.rightDegrees*e.PI_OVER_180),l=2/(s+u),c=2/(o+a);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(s-u)*l*.5,t[9]=(o-a)*c*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t}},{key:"mat4_fromRotationTranslation",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0],r=t[0],i=t[1],o=t[2],a=t[3],s=r+r,u=i+i,l=o+o,c=r*s,f=r*u,h=r*l,d=i*u,_=i*l,y=o*l,p=a*s,v=a*u,w=a*l;return e[0]=1-(d+y),e[1]=f+w,e[2]=h-v,e[3]=0,e[4]=f-w,e[5]=1-(c+y),e[6]=_+p,e[7]=0,e[8]=h+v,e[9]=_-p,e[10]=1-(c+d),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}},{key:"mat4_translate",value:function(e,t,n){var r=n[0],i=n[1],o=n[2],a=void 0,s=void 0,u=void 0,l=void 0,c=void 0,f=void 0,h=void 0,d=void 0,_=void 0,y=void 0,p=void 0,v=void 0;return t===e?(e[12]=t[0]*r+t[4]*i+t[8]*o+t[12],e[13]=t[1]*r+t[5]*i+t[9]*o+t[13],e[14]=t[2]*r+t[6]*i+t[10]*o+t[14],e[15]=t[3]*r+t[7]*i+t[11]*o+t[15]):(a=t[0],s=t[1],u=t[2],l=t[3],c=t[4],f=t[5],h=t[6],d=t[7],_=t[8],y=t[9],p=t[10],v=t[11],e[0]=a,e[1]=s,e[2]=u,e[3]=l,e[4]=c,e[5]=f,e[6]=h,e[7]=d,e[8]=_,e[9]=y,e[10]=p,e[11]=v,e[12]=a*r+c*i+_*o+t[12],e[13]=s*r+f*i+y*o+t[13],e[14]=u*r+h*i+p*o+t[14],e[15]=l*r+d*i+v*o+t[15]),e}},{key:"mat4_invert",value:function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],c=t[8],f=t[9],h=t[10],d=t[11],_=t[12],y=t[13],p=t[14],v=t[15],w=n*s-r*a,m=n*u-i*a,b=n*l-o*a,g=r*u-i*s,E=r*l-o*s,T=i*l-o*u,x=c*y-f*_,A=c*p-h*_,R=c*v-d*_,k=f*p-h*y,O=f*v-d*y,P=h*v-d*p,M=w*P-m*O+b*k+g*R-E*A+T*x;return M?(M=1/M,e[0]=(s*P-u*O+l*k)*M,e[1]=(i*O-r*P-o*k)*M,e[2]=(y*T-p*E+v*g)*M,e[3]=(h*E-f*T-d*g)*M,e[4]=(u*R-a*P-l*A)*M,e[5]=(n*P-i*R+o*A)*M,e[6]=(p*b-_*T-v*m)*M,e[7]=(c*T-h*b+d*m)*M,e[8]=(a*O-s*R+l*x)*M,e[9]=(r*R-n*O-o*x)*M,e[10]=(_*E-y*b+v*w)*M,e[11]=(f*b-c*E-d*w)*M,e[12]=(s*A-a*k-u*x)*M,e[13]=(n*k-r*A+i*x)*M,e[14]=(y*m-_*g-p*w)*M,e[15]=(c*g-f*m+h*w)*M,e):null}},{key:"mat4_multiply",value:function(e,t,n){var r=t[0],i=t[4],o=t[8],a=t[12],s=t[1],u=t[5],l=t[9],c=t[13],f=t[2],h=t[6],d=t[10],_=t[14],y=t[3],p=t[7],v=t[11],w=t[15],m=n[0],b=n[4],g=n[8],E=n[12],T=n[1],x=n[5],A=n[9],R=n[13],k=n[2],O=n[6],P=n[10],M=n[14],S=n[3],C=n[7],N=n[11],I=n[15];return e[0]=r*m+i*T+o*k+a*S,e[4]=r*b+i*x+o*O+a*C,e[8]=r*g+i*A+o*P+a*N,e[12]=r*E+i*R+o*M+a*I,e[1]=s*m+u*T+l*k+c*S,e[5]=s*b+u*x+l*O+c*C,e[9]=s*g+u*A+l*P+c*N,e[13]=s*E+u*R+l*M+c*I,e[2]=f*m+h*T+d*k+_*S,e[6]=f*b+h*x+d*O+_*C,e[10]=f*g+h*A+d*P+_*N,e[14]=f*E+h*R+d*M+_*I,e[3]=y*m+p*T+v*k+w*S,e[7]=y*b+p*x+v*O+w*C,e[11]=y*g+p*A+v*P+w*N,e[15]=y*E+p*R+v*M+w*I,e}}]),e}();t.default=s,s.PI_OVER_180=Math.PI/180},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;r(this,e),this.x=t,this.y=n,this.z=i,this.w=o}return i(e,[{key:"set",value:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}},{key:"toArray",value:function(){return[this.x,this.y,this.z,this.w]}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:"setFromRotationMatrix",value:function(e){var t=e[0],n=e[4],r=e[8],i=e[1],o=e[5],a=e[9],s=e[2],u=e[6],l=e[10],c=t+o+l;if(c>0){var f=.5/Math.sqrt(c+1);this.w=.25/f,this.x=(u-a)*f,this.y=(r-s)*f,this.z=(i-n)*f}else if(t>o&&t>l){var h=2*Math.sqrt(1+t-o-l);this.w=(u-a)/h,this.x=.25*h,this.y=(n+i)/h,this.z=(r+s)/h}else if(o>l){var d=2*Math.sqrt(1+o-t-l);this.w=(r-s)/d,this.x=(n+i)/d,this.y=.25*d,this.z=(a+u)/d}else{var _=2*Math.sqrt(1+l-t-o);this.w=(i-n)/_,this.x=(r+s)/_,this.y=(a+u)/_,this.z=.25*_}return this}},{key:"setFromEuler",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"XYZ",i=Math.cos,o=Math.sin,a=i(e/2),s=i(t/2),u=i(n/2),l=o(e/2),c=o(t/2),f=o(n/2);"XYZ"===r?(this.x=l*s*u+a*c*f,this.y=a*c*u-l*s*f,this.z=a*s*f+l*c*u,this.w=a*s*u-l*c*f):"YXZ"===r?(this.x=l*s*u+a*c*f,this.y=a*c*u-l*s*f,this.z=a*s*f-l*c*u,this.w=a*s*u+l*c*f):"ZXY"===r?(this.x=l*s*u-a*c*f,this.y=a*c*u+l*s*f,this.z=a*s*f+l*c*u,this.w=a*s*u-l*c*f):"ZYX"===r?(this.x=l*s*u-a*c*f,this.y=a*c*u+l*s*f,this.z=a*s*f-l*c*u,this.w=a*s*u+l*c*f):"YZX"===r?(this.x=l*s*u+a*c*f,this.y=a*c*u+l*s*f,this.z=a*s*f-l*c*u,this.w=a*s*u-l*c*f):"XZY"===r&&(this.x=l*s*u-a*c*f,this.y=a*c*u-l*s*f,this.z=a*s*f+l*c*u,this.w=a*s*u+l*c*f)}},{key:"setFromAxisAngle",value:function(e,t){var n=t/2,r=Math.sin(n);return this.x=e.x*r,this.y=e.y*r,this.z=e.z*r,this.w=Math.cos(n),this}},{key:"multiply",value:function(e){return this.multiplyQuaternions(this,e)}},{key:"multiplyQuaternions",value:function(e,t){var n=e.x,r=e.y,i=e.z,o=e.w,a=t.x,s=t.y,u=t.z,l=t.w;return this.x=n*l+o*a+r*u-i*s,this.y=r*l+o*s+i*a-n*u,this.z=i*l+o*u+n*s-r*a,this.w=o*l-n*a-r*s-i*u,this}},{key:"inverse",value:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this}},{key:"normalize",value:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this.x,r=this.y,i=this.z,o=this.w,a=o*e.w+n*e.x+r*e.y+i*e.z;if(a<0?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,a=-a):this.copy(e),a>=1)return this.w=o,this.x=n,this.y=r,this.z=i,this;var s=Math.acos(a),u=Math.sqrt(1-a*a);if(Math.abs(u)<.001)return this.w=.5*(o+this.w),this.x=.5*(n+this.x),this.y=.5*(r+this.y),this.z=.5*(i+this.z),this;var l=Math.sin((1-t)*s)/u,c=Math.sin(t*s)/u;return this.w=o*l+this.w*c,this.x=n*l+this.x*c,this.y=r*l+this.y*c,this.z=i*l+this.z*c,this}}]),e}();t.default=o},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){r(this,e),this._listeners=new Map}return i(e,[{key:"addEventListener",value:function(e,t){var n=this._listeners.get(e);!1===Array.isArray(n)&&(n=[],this._listeners.set(e,n)),n.push(t)}},{key:"removeEventListener",value:function(e,t){var n=this._listeners.get(e);if(!1!==Array.isArray(n))for(var r=0;r<n.length;r++)if(n[r]===t)return void n.splice(r,1)}},{key:"dispatchEvent",value:function(e){var t=this._listeners.get(e.type);if(!1!==Array.isArray(t)){var n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){(0,o.value)(e)}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}}}}]),e}();t.default=o},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;r(this,e),this._uid=null==n?e._generateUID():n,this._coordinates=t}return i(e,[{key:"uid",get:function(){return this._uid}},{key:"coordinates",get:function(){return this._coordinates},set:function(e){this._coordinates=e}}],[{key:"_generateUID",value:function(){return"anchor-"+(new Date).getTime()+"-"+Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}}]),e}();t.default=o},function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(0),s=r(a),u=n(1),l=r(u),c=n(13),f=r(c),h=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0,0,1];i(this,e),this._display=t,this._coordinateSystem=n,this._poseMatrix=new Float32Array(16),s.default.mat4_fromRotationTranslation(this._poseMatrix,o,r)}return o(e,[{key:"getTransformedCoordinates",value:function(t){if(this._coordinateSystem.type===f.default.GEOSPATIAL||t.type===f.default.GEOSPATIAL)return console.error("This polyfill does not yet support geospatial coordinate systems"),null;var n=this._coordinateSystem.getTransformTo(t);if(null===n)return console.error("Could not get a transform between",this._coordinateSystem,t),null;var r=new e(this._display,t);return s.default.mat4_multiply(r._poseMatrix,n,this._poseMatrix),r}},{key:"coordinateSystem",get:function(){return this._coordinateSystem}},{key:"poseMatrix",get:function(){return this._poseMatrix},set:function(e){for(var t=0;t<16;t++)this._poseMatrix[t]=e[t]}},{key:"position",get:function(){return new Float32Array([this._poseMatrix[12],this._poseMatrix[13],this._poseMatrix[14]])}},{key:"orientation",get:function(){var e=new l.default;return e.setFromRotationMatrix(this._poseMatrix),e.toArray()}}]),e}();t.default=h},function(e,t,n){function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(2),c=i(l),f=n(18),h=i(f),d=n(19),_=i(d),y=function(e){function t(e,n,r,i){o(this,t);var s=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));s._xr=e,s._displayName=n,s._isExternal=r,s._reality=i,s._headModelCoordinateSystem=new XRCoordinateSystem(s,XRCoordinateSystem.HEAD_MODEL),s._eyeLevelCoordinateSystem=new XRCoordinateSystem(s,XRCoordinateSystem.EYE_LEVEL),s._trackerCoordinateSystem=new XRCoordinateSystem(s,XRCoordinateSystem.TRACKER),s._headPose=new XRViewPose([0,XRViewPose.SITTING_EYE_HEIGHT,0]),s._eyeLevelPose=new XRViewPose([0,XRViewPose.SITTING_EYE_HEIGHT,0]),s._trackerPoseModelMatrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);return s._fov=new h.default(25,25,25,25),s._depthNear=.1,s._depthFar=1e3,s._views=[],s}return s(t,e),u(t,[{key:"supportsSession",value:function(e){return this._supportedCreationParameters(e)}},{key:"requestSession",value:function(e){var t=this;return new Promise(function(n,r){if(!1===t._supportedCreationParameters(e))return void r();e.type===XRSession.REALITY&&(t._reality=new _.default,t._xr._privateRealities.push(t._reality)),n(t._createSession(e))})}},{key:"_requestAnimationFrame",value:function(e){return window.requestAnimationFrame(e)}},{key:"_cancelAnimationFrame",value:function(e){return window.cancelAnimationFrame(e)}},{key:"_createSession",value:function(e){return new XRSession(this._xr,this,e)}},{key:"_supportedCreationParameters",value:function(e){throw"Should be implemented by extending class"}},{key:"_handleNewFrame",value:function(e){}},{key:"_handleAfterFrame",value:function(e){}},{key:"_handleNewBaseLayer",value:function(e){}},{key:"displayName",get:function(){return this._displayName}},{key:"isExternal",get:function(){return this._isExternal}}]),t}(c.default);t.default=y},function(e,t,n){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(2),l=function(e){return e&&e.__esModule?e:{default:e}}(u),c=function(e){function t(e,n,r,a){i(this,t);var s=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return s._xr=e,s._name=n,s._isShared=r,s._isPassthrough=a,s._anchors=new Map,s}return a(t,e),s(t,[{key:"getCoordinateSystem",value:function(){throw new Error("Not implemented")}},{key:"_start",value:function(){throw new Error("Exending classes should implement _start")}},{key:"_stop",value:function(){throw new Error("Exending classes should implement _stop")}},{key:"_handleNewFrame",value:function(){}},{key:"_addAnchor",value:function(e,t){throw new Error("Exending classes should implement _addAnchor")}},{key:"_findAnchor",value:function(e,t,n){throw new Error("Exending classes should implement _findAnchor")}},{key:"_findFloorAnchor",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=new Float32Array(e._headPose.poseModelMatrix);return new Promise(function(i,o){var a=new XRCoordinates(e,e._trackerCoordinateSystem);r[13]=0,a.poseMatrix=r;var s=new XRAnchor(a,n);t._addAnchor(s,e),i(new XRAnchorOffset(s.uid))})}},{key:"_getAnchor",value:function(e){return this._anchors.get(e)||null}},{key:"_removeAnchor",value:function(e){throw new Error("Exending classes should implement _removeAnchor")}},{key:"name",get:function(){return this._name}},{key:"isShared",get:function(){return this._isShared}},{key:"isPassthrough",get:function(){return this._isPassthrough}}]),t}(l.default);t.default=c},function(e,t,n){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(2),l=function(e){return e&&e.__esModule?e:{default:e}}(u),c=function(e){function t(e,n,r){i(this,t);var a=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a._xr=e,a._display=n,a._createParameters=r,a._baseLayer=null,a._stageBounds=null,a}return a(t,e),s(t,[{key:"requestFrame",value:function(e){var t=this;if("function"!=typeof e)throw"Invalid callback";return this._display._requestAnimationFrame(function(){var n=t._createPresentationFrame();t._display._reality._handleNewFrame(n),t._display._handleNewFrame(n),e(n),t._display._handleAfterFrame(n)})}},{key:"cancelFrame",value:function(e){return this._display._cancelAnimationFrame(e)}},{key:"end",value:function(){throw"Not implemented"}},{key:"_createPresentationFrame",value:function(){return new XRPresentationFrame(this)}},{key:"_getCoordinateSystem",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){switch(a.value){case XRCoordinateSystem.HEAD_MODEL:return this._display._headModelCoordinateSystem;case XRCoordinateSystem.EYE_LEVEL:return this._display._eyeLevelCoordinateSystem;case XRCoordinateSystem.TRACKER:return this._display._trackerCoordinateSystem;case XRCoordinateSystem.GEOSPATIAL:default:continue}}}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return null}},{key:"display",get:function(){return this._display}},{key:"createParameters",get:function(){return this._parameters}},{key:"realities",get:function(){return this._xr._sharedRealities}},{key:"reality",get:function(){return this._display._reality}},{key:"baseLayer",get:function(){return this._baseLayer},set:function(e){this._baseLayer=e,this._display._handleNewBaseLayer(this._baseLayer)}},{key:"depthNear",get:function(){this._display._depthNear},set:function(e){this._display._depthNear=e}},{key:"depthFar",get:function(){this._display._depthFar},set:function(e){this._display._depthFar=e}},{key:"hasStageBounds",get:function(){this._stageBounds}},{key:"stageBounds",get:function(){return this._stageBounds}}]),t}(l.default);t.default=c,c.REALITY="reality",c.AUGMENTATION="augmentation",c.TYPES=[c.REALITY,c.AUGMENTATION]},function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(14),s=r(a),u=n(0),l=r(u),c=function(){function e(t,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;i(this,e),this._fov=t,this._depthNear=n,this._depthFar=r,this._eye=o,this._viewport=new s.default(0,0,1,1),this._projectionMatrix=new Float32Array(16),l.default.mat4_perspectiveFromFieldOfView(this._projectionMatrix,this._fov,this._depthNear,this._depthFar)}return o(e,[{key:"setProjectionMatrix",value:function(e){for(var t=0;t<16;t++)this._projectionMatrix[t]=e[t]}},{key:"getViewport",value:function(t){return this._eye===e.LEFT?(this._viewport.x=0,this._viewport.y=0,this._viewport.width=t.framebufferWidth/2,this._viewport.height=t.framebufferHeight):this._eye===e.RIGHT?(this._viewport.x=t.framebufferWidth/2,this._viewport.y=0,this._viewport.width=t.framebufferWidth/2,this._viewport.height=t.framebufferHeight):(this._viewport.x=0,this._viewport.y=0,this._viewport.width=t.framebufferWidth,this._viewport.height=t.framebufferHeight),this._viewport}},{key:"eye",get:function(){return this._eye}},{key:"projectionMatrix",get:function(){return this._projectionMatrix}}]),e}();t.default=c,c.LEFT="left",c.RIGHT="right",c.EYES=[c.LEFT,c.RIGHT]},function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(0),s=r(a),u=n(1),l=r(u),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,1];i(this,e),this._poseModelMatrix=new Float32Array(16),s.default.mat4_fromRotationTranslation(this._poseModelMatrix,n,t)}return o(e,[{key:"_setPoseModelMatrix",value:function(e){for(var t=0;t<16;t++)this._poseModelMatrix[t]=e[t]}},{key:"_translate",value:function(e){this._poseModelMatrix[12]+=e[0],this._poseModelMatrix[13]+=e[1],this._poseModelMatrix[14]+=e[2]}},{key:"getViewMatrix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null===t&&(t=new Float32Array(16)),s.default.mat4_eyeView(t,this._poseModelMatrix),t}},{key:"poseModelMatrix",get:function(){return this._poseModelMatrix}},{key:"_position",get:function(){return[this._poseModelMatrix[12],this._poseModelMatrix[13],this._poseModelMatrix[14]]},set:function(e){this._poseModelMatrix[12]=e[0],this._poseModelMatrix[13]=e[1],this._poseModelMatrix[14]=e[2]}},{key:"_orientation",get:function(){var e=new l.default;return e.setFromRotationMatrix(this._poseModelMatrix),e.toArray()},set:function(e){s.default.mat4_fromRotationTranslation(this._poseModelMatrix,e,this._position)}}]),e}();t.default=c,c.SITTING_EYE_HEIGHT=1.1},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;r(this,e),this.x=t,this.y=n,this.z=i}return i(e,[{key:"set",value:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"add",value:function(e,t,n){this.x+=e,this.y+=t,this.z+=n}},{key:"normalize",value:function(){var e=this.length();return 0!==e?this.multiplyScalar(1/e):(this.x=0,this.y=0,this.z=0),this}},{key:"multiplyScalar",value:function(e){this.x*=e,this.y*=e,this.z*=e}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,o=e.y,a=e.z,s=e.w,u=s*t+o*r-a*n,l=s*n+a*t-i*r,c=s*r+i*n-o*t,f=-i*t-o*n-a*r;return this.x=u*s+f*-i+l*-a-c*-o,this.y=l*s+f*-o+c*-i-u*-a,this.z=c*s+f*-a+u*-o-l*-i,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,i=1/(e[3]*t+e[7]*n+e[11]*r+e[15]);return this.x=(e[0]*t+e[4]*n+e[8]*r+e[12])*i,this.y=(e[1]*t+e[5]*n+e[9]*r+e[13])*i,this.z=(e[2]*t+e[6]*n+e[10]*r+e[14])*i,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"crossVectors",value:function(e,t){var n=e.x,r=e.y,i=e.z,o=t.x,a=t.y,s=t.z;return this.x=r*s-i*a,this.y=i*o-n*s,this.z=n*a-r*o,this}}]),e}();t.default=o},function(e,t,n){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return void 0===e?"undefined":r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":r(e)},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(2),c=function(e){return e&&e.__esModule?e:{default:e}}(l),f=function(e){function t(){i(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(!1===t.HasARKit())throw"ARKitWrapper will only work in Mozilla's ARDemo test app";if(void 0!==t.GLOBAL_INSTANCE)throw"ARKitWrapper is a singleton. Use ARKitWrapper.GetOrCreate() to get the global instance.";e._deviceId=null,e._isWatching=!1,e._isInitialized=!1,e._rawARData=null,e._globalCallbacksMap={};for(var n=["onInit","onWatch"],r=0;r<n.length;r++)e._generateGlobalCallback(n[r],r);for(var a=[["arkitStartRecording",t.RECORD_START_EVENT],["arkitStopRecording",t.RECORD_STOP_EVENT],["arkitDidMoveBackground",t.DID_MOVE_BACKGROUND_EVENT],["arkitWillEnterForeground",t.WILL_ENTER_FOREGROUND_EVENT],["arkitInterrupted",t.INTERRUPTED_EVENT],["arkitInterruptionEnded",t.INTERRUPTION_ENDED_EVENT],["arkitShowDebug",t.SHOW_DEBUG_EVENT]],s=0;s<a.length;s++)!function(t){window[a[t][0]]=function(n){n=n||null,e.dispatchEvent(new CustomEvent(a[t][1],{source:e,detail:n}))}}(s);return e}return a(t,e),u(t,[{key:"waitForInit",value:function(){var e=this;return new Promise(function(n,r){if(e._isInitialized)return void n();var i=function r(){e.removeEventListener(t.INIT_EVENT,r,!1),n()};e.addEventListener(t.INIT_EVENT,i,!1)})}},{key:"getData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===e?this._rawARData:this._rawARData&&void 0!==this._rawARData[e]?this._rawARData[e]:null}},{key:"getObject",value:function(e){if(!this._isInitialized)return null;var t=this.getKey("objects");if(null===t)return null;var n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;if(s.uuid===e)return s}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return null}},{key:"hitTest",value:function(e,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.HIT_TEST_TYPE_ALL;return new Promise(function(t,o){if(!r._isInitialized)return void o(new Error("ARKit is not initialized"));window.webkit.messageHandlers.hitTest.postMessage({x:e,y:n,type:i,callback:r._createPromiseCallback("hitTest",t)})})}},{key:"addAnchor",value:function(e,t){var n=this;return new Promise(function(r,i){if(!n._isInitialized)return void i(new Error("ARKit is not initialized"));window.webkit.messageHandlers.addAnchor.postMessage({uuid:e,transform:t,callback:n._createPromiseCallback("addAnchor",r)})})}},{key:"stop",value:function(){var e=this;return new Promise(function(t,n){if(!e._isWatching)return void t();window.webkit.messageHandlers.stopAR.postMessage({callback:e._createPromiseCallback("stop",t)})})}},{key:"watch",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!this._isInitialized)return!1;if(this._isWatching)return!0;this._isWatching=!0,null===e&&(e={location:!0,camera:!0,objects:!0,light_intensity:!0});var t={options:e,callback:this._globalCallbacksMap.onWatch};return window.webkit.messageHandlers.watchAR.postMessage(t),!0}},{key:"setUIOptions",value:function(e){window.webkit.messageHandlers.setUIOptions.postMessage(e)}},{key:"_sendInit",value:function(e){window.webkit.messageHandlers.initAR.postMessage({options:e,callback:this._globalCallbacksMap.onInit})}},{key:"_onInit",value:function(e){this._deviceId=e,this._isInitialized=!0,this.dispatchEvent(new CustomEvent(t.INIT_EVENT,{source:this}))}},{key:"_onWatch",value:function(e){this._rawARData=e,this.dispatchEvent(new CustomEvent(t.WATCH_EVENT,{source:this,detail:this._rawARData}))}},{key:"_onStop",value:function(){this._isWatching=!1}},{key:"_createPromiseCallback",value:function(e,t){var n=this,r=this._generateCallbackUID(e);return window[r]=function(i){delete window[r];var o="_on"+e[0].toUpperCase()+e.slice(1);"function"==typeof n[o]&&n[o](i),t(i)},r}},{key:"_generateCallbackUID",value:function(e){return"arkitCallback_"+e+"_"+(new Date).getTime()+"_"+Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}},{key:"_generateGlobalCallback",value:function(e,t){var n="arkitCallback"+t;this._globalCallbacksMap[e]=n;var r=this;window[n]=function(t){r["_"+e](t)}}},{key:"deviceId",get:function(){return this._deviceId}},{key:"isWatching",get:function(){return this._isWatching}},{key:"isInitialized",get:function(){return this._isInitialized}},{key:"hasData",get:function(){return null!==this._rawARData}}],[{key:"GetOrCreate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(void 0===t.GLOBAL_INSTANCE){t.GLOBAL_INSTANCE=new t,e=e&&"object"==(void 0===e?"undefined":s(e))?e:{};var n={browser:!0,points:!0,focus:!1,rec:!0,rec_time:!0,mic:!1,build:!1,plane:!0,warnings:!0,anchors:!1,debug:!0,statistics:!1},r="object"==s(e.ui)?e.ui:{};e.ui=Object.assign(n,r),t.GLOBAL_INSTANCE._sendInit(e)}return t.GLOBAL_INSTANCE}},{key:"HasARKit",value:function(){return void 0!==window.webkit}}]),t}(c.default);t.default=f,f.INIT_EVENT="arkit-init",f.WATCH_EVENT="arkit-watch",f.RECORD_START_EVENT="arkit-record-start",f.RECORD_STOP_EVENT="arkit-record-stop",f.DID_MOVE_BACKGROUND_EVENT="arkit-did-move-background",f.WILL_ENTER_FOREGROUND_EVENT="arkit-will-enter-foreground",f.INTERRUPTED_EVENT="arkit-interrupted",f.INTERRUPTION_ENDED_EVENT="arkit-interruption-ended",f.SHOW_DEBUG_EVENT="arkit-show-debug",f.HIT_TEST_TYPE_FEATURE_POINT=1,f.HIT_TEST_TYPE_EXISTING_PLANE=8,f.HIT_TEST_TYPE_ESTIMATED_HORIZONTAL_PLANE=2,f.HIT_TEST_TYPE_EXISTING_PLANE_USING_EXTENT=16,f.HIT_TEST_TYPE_ALL=f.HIT_TEST_TYPE_FEATURE_POINT|f.HIT_TEST_TYPE_EXISTING_PLANE|f.HIT_TEST_TYPE_ESTIMATED_HORIZONTAL_PLANE|f.HIT_TEST_TYPE_EXISTING_PLANE_USING_EXTENT,f.HIT_TEST_TYPE_EXISTING_PLANES=f.HIT_TEST_TYPE_EXISTING_PLANE|f.HIT_TEST_TYPE_EXISTING_PLANE_USING_EXTENT},function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(0),s=r(a),u=n(1),l=r(u),c=n(3),f=(r(c),n(4)),h=r(f),d=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;i(this,e),this._anchorUID=t,this._poseMatrix=n||s.default.mat4_generateIdentity()}return o(e,[{key:"getTransformedCoordinates",value:function(e){var t=new h.default(e.coordinates._display,e.coordinates.coordinateSystem);return s.default.mat4_multiply(t.poseMatrix,this._poseMatrix,e.coordinates.poseMatrix),t}},{key:"anchorUID",get:function(){return this._anchorUID}},{key:"poseMatrix",get:function(){return this._poseMatrix},set:function(e){for(var t=0;t<16;t++)this._poseMatrix[t]=e[t]}},{key:"position",get:function(){return new Float32Array([this._poseMatrix[12],this._poseMatrix[13],this._poseMatrix[14]])}},{key:"orientation",get:function(){var e=new l.default;return e.setFromRotationMatrix(this._poseMatrix),e.toArray()}}]),e}();t.default=d},function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(0),s=r(a),u=n(4),l=r(u),c=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;i(this,e),this._display=t,this._type=n,this._cartographicCoordinates=r}return o(e,[{key:"getCoordinates",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,1];return new l.default(this._display,this,e,t)}},{key:"getTransformTo",value:function(e){var t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),n=new Float32Array(16);return s.default.mat4_invert(n,e._poseModelMatrix),s.default.mat4_multiply(t,n,t),s.default.mat4_multiply(t,this._poseModelMatrix,t),t}},{key:"cartographicCoordinates",get:function(){return this._cartographicCoordinates}},{key:"type",get:function(){return this._type}},{key:"_poseModelMatrix",get:function(){switch(this._type){case e.HEAD_MODEL:return this._display._headPose.poseModelMatrix;case e.EYE_LEVEL:return this._display._eyeLevelPose.poseModelMatrix;case e.TRACKER:return this._display._trackerPoseModelMatrix;case e.GEOSPATIAL:throw"This polyfill does not yet handle geospatial coordinate systems";default:throw"Unknown coordinate system type: "+this._type}}}]),e}();t.default=c,c.HEAD_MODEL="headModel",c.EYE_LEVEL="eyeLevel",c.TRACKER="tracker",c.GEOSPATIAL="geospatial",c.TYPES=[c.HEAD_MODEL,c.EYE_LEVEL,c.TRACKER,c.GEOSPATIAL]},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t,n,i,o){r(this,e),this._x=t,this._y=n,this._width=i,this._height=o}return i(e,[{key:"x",get:function(){return this._x},set:function(e){this._x=e}},{key:"y",get:function(){return this._y},set:function(e){this._y=e}},{key:"width",get:function(){return this._width},set:function(e){this._width=e}},{key:"height",get:function(){return this._height},set:function(e){this._height=e}}]),e}();t.default=o},function(e,t,n){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),u=function(e){return e&&e.__esModule?e:{default:e}}(s),l=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),t}(u.default);t.default=l},function(e,t,n){function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(2),c=i(l),f=n(10),h=i(f),d=n(1),_=i(d),y=n(30),p=i(y),v=function(e){function t(){o(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._deviceOrientation=null,e._windowOrientation=0,window.addEventListener("orientationchange",function(){e._windowOrientation=window.orientation||0},!1),window.addEventListener("deviceorientation",function(n){e._deviceOrientation=n,e.dispatchEvent(new CustomEvent(t.ORIENTATION_UPDATE_EVENT,{deviceOrientation:e._deviceOrientation,windowOrientation:e._windowOrientation}))},!1),e}return s(t,e),u(t,[{key:"getOrientation",value:function(e){return null===this._deviceOrientation?(e.set(0,0,0,1),!1):(t.WORKING_EULER.set(this._deviceOrientation.beta*t.DEG_TO_RAD,this._deviceOrientation.alpha*t.DEG_TO_RAD,-1*this._deviceOrientation.gamma*t.DEG_TO_RAD,"YXZ"),e.setFromEuler(t.WORKING_EULER.x,t.WORKING_EULER.y,t.WORKING_EULER.z,t.WORKING_EULER.order),e.multiply(t.HALF_PI_AROUND_X),e.multiply(t.WORKING_QUATERNION.setFromAxisAngle(t.Z_AXIS,-this._windowOrientation*t.DEG_TO_RAD)),!0)}}]),t}(c.default);t.default=v,v.ORIENTATION_UPDATE_EVENT="orientation-update",v.Z_AXIS=new h.default(0,0,1),v.WORKING_EULER=new p.default,v.WORKING_QUATERNION=new _.default,v.HALF_PI_AROUND_X=new _.default(-Math.sqrt(.5),0,0,Math.sqrt(.5)),v.DEG_TO_RAD=Math.PI/180},function(e,t,n){function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(5),c=i(l),f=n(7),h=i(f),d=n(20),_=i(d),y=n(6),p=i(y),v=n(21),w=i(v),m=n(22),b=i(m),g=n(3),E=i(g),T=n(23),x=i(T),A=n(12),R=i(A),k=n(24),O=i(k),P=n(25),M=i(P),S=n(26),C=i(S),N=n(8),I=i(N),D=n(14),F=i(D),j=n(27),L=i(j),W=n(13),X=i(W),z=n(4),H=i(z),G=n(9),U=i(G),V=n(15),B=i(V),Y=n(28),K=i(Y),q=n(2),Z=i(q),Q=n(29),J=i(Q),$=n(31),ee=i($),te=n(32),ne=i(te),re=function(e){function t(){o(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));window.XRDisplay=c.default,window.XRSession=h.default,window.XRSessionCreateParameters=_.default,window.Reality=p.default,window.XRPointCloud=w.default,window.XRLightEstimate=b.default,window.XRAnchor=E.default,window.XRPlaneAnchor=x.default,window.XRAnchorOffset=R.default,window.XRStageBounds=O.default,window.XRStageBoundsPoint=M.default,window.XRPresentationFrame=C.default,window.XRView=I.default,window.XRViewport=F.default,window.XRCartographicCoordinates=L.default,window.XRCoordinateSystem=X.default,window.XRCoordinates=H.default,window.XRViewPose=U.default,window.XRLayer=B.default,window.XRWebGLLayer=K.default,e._sharedRealities=[new ne.default(e)],e._privateRealities=[],e._displays=[new J.default(e,e._sharedRealities[0])],"function"==typeof navigator.getVRDisplays&&navigator.getVRDisplays().then(function(t){var n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;null!==s&&(s.capabilities.canPresent&&e._displays.push(new ee.default(e,e._sharedRealities[0],s)))}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}}),e._sessionEls=document.createElement("div"),e._sessionEls.setAttribute("class","webxr-sessions"),e._realityEls=document.createElement("div"),e._realityEls.setAttribute("class","webxr-realities");for(var n=[e._sessionEls,e._realityEls],r=0;r<n.length;r++){var i=n[r];i.style.position="absolute",i.style.width="100%",i.style.height="100%"}return document.addEventListener("DOMContentLoaded",function(){document.body.style.width="100%",document.body.style.height="100%",document.body.prepend(e._sessionEls),document.body.prepend(e._realityEls)}),e}return s(t,e),u(t,[{key:"getDisplays",value:function(){var e=this;return new Promise(function(t,n){t(e._displays)})}}]),t}(Z.default);void 0===navigator.XR&&(navigator.XR=new re)},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t,n,i,o){r(this,e),this._upDegrees=t,this._downDegrees=n,this._leftDegrees=i,this._rightDegrees=o}return i(e,[{key:"upDegrees",get:function(){return this._upDegrees}},{key:"downDegrees",get:function(){return this._downDegrees}},{key:"leftDegrees",get:function(){return this._leftDegrees}},{key:"rightDegrees",get:function(){return this._rightDegrees}}]),e}();t.default=o},function(e,t,n){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(6),l=function(e){return e&&e.__esModule?e:{default:e}}(u),c=function(e){function t(e){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Virtual",!1,!1))}return a(t,e),s(t,[{key:"_start",value:function(){}},{key:"_stop",value:function(){}},{key:"_handleNewFrame",value:function(){}},{key:"_addAnchor",value:function(e,t){return this._anchors.set(e.uid,e),e.uid}},{key:"_findAnchor",value:function(e,t,n){return new Promise(function(e,t){e(null)})}},{key:"_removeAnchor",value:function(e){this._anchors.delete(e)}}]),t}(l.default);t.default=c},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){r(this,e)}return i(e,[{key:"exclusive",get:function(){throw"Not implemented"}},{key:"type",get:function(){throw"Not implemented"}}]),e}();t.default=o},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){r(this,e)}return i(e,[{key:"points",get:function(){throw new Error("Not implemented")}}]),e}();t.default=o},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){r(this,e)}return i(e,[{key:"getAmbientColorTemperature",value:function(){throw new Error("Not implemented")}},{key:"ambientIntensity",get:function(){throw new Error("Not implemented")}}]),e}();t.default=o},function(e,t,n){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(3),l=function(e){return e&&e.__esModule?e:{default:e}}(u),c=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),s(t,[{key:"width",get:function(){throw"Not implemented"}},{key:"length",get:function(){throw"Not implemented"}}]),t}(l.default);t.default=c},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){r(this,e)}return i(e,[{key:"center",get:function(){throw new Error("Not implemented")}},{key:"geometry",get:function(){throw new Error("Not implemented")}}]),e}();t.default=o},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){r(this,e)}return i(e,[{key:"x",get:function(){throw new Error("Not implemented")}},{key:"y",get:function(){throw new Error("Not implemented")}}]),e}();t.default=o},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(3),a=(function(e){e&&e.__esModule}(o),function(){function e(t){r(this,e),this._session=t}return i(e,[{key:"addAnchor",value:function(e){return this._session.reality._addAnchor(e,this._session.display)}},{key:"findAnchor",value:function(e,t){return this._session.reality._findAnchor(e,t,this._session.display)}},{key:"findFloorAnchor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this._session.reality._findFloorAnchor(this._session.display,e)}},{key:"removeAnchor",value:function(e){return this._session.reality._removeAnchor(e)}},{key:"getAnchor",value:function(e){return this._session.reality._getAnchor(e)}},{key:"getCoordinateSystem",value:function(){var e;return(e=this._session)._getCoordinateSystem.apply(e,arguments)}},{key:"getViewPose",value:function(e){switch(e.type){case XRCoordinateSystem.HEAD_MODEL:return this._session._display._headPose;case XRCoordinateSystem.EYE_LEVEL:return this._session._display._eyeLevelPose;default:return null}}},{key:"session",get:function(){return this._session}},{key:"views",get:function(){return this._session._display._views}},{key:"hasPointCloud",get:function(){return!1}},{key:"pointCloud",get:function(){return null}},{key:"hasLightEstimate",get:function(){return!1}},{key:"lightEstimate",get:function(){return null}},{key:"anchors",get:function(){var e=[],t=!0,n=!1,r=void 0;try{for(var i,o=this._session.reality._anchors.values()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;e.push(a)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}return e}}]),e}());t.default=a},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){r(this,e)}return i(e,[{key:"geodeticFrame",get:function(){throw new Error("Not implemented")}},{key:"latitude",get:function(){throw new Error("Not implemented")}},{key:"longitude",get:function(){throw new Error("Not implemented")}},{key:"positionAccuracy",get:function(){throw new Error("Not implemented")}},{key:"altitude",get:function(){throw new Error("Not implemented")}},{key:"altitudeAccuracy",get:function(){throw new Error("Not implemented")}},{key:"orientation",get:function(){throw new Error("Not implemented")}}]),e}();t.default=o,o.WGS84="WGS84",o.GEODETIC_FRAMES=[o.WGS84]},function(e,t,n){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(15),l=function(e){return e&&e.__esModule?e:{default:e}}(u),c=function(e){function t(e,n){i(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._session=e,r._context=n,r._framebuffer=null,r}return a(t,e),s(t,[{key:"requestViewportScaling",value:function(e){throw"Not implemented"}},{key:"context",get:function(){return this._context}},{key:"antialias",get:function(){throw"Not implemented"}},{key:"depth",get:function(){throw"Not implemented"}},{key:"stencil",get:function(){throw"Not implemented"}},{key:"alpha",get:function(){throw"Not implemented"}},{key:"multiview",get:function(){throw"Not implemented"}},{key:"framebuffer",get:function(){return this._framebuffer}},{key:"framebufferWidth",get:function(){return this._context.drawingBufferWidth}},{key:"framebufferHeight",get:function(){return this._context.drawingBufferHeight}}]),t}(l.default);t.default=c},function(e,t,n){function i(e){return e&&e.__esModule?e:{default:e}}function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},f=n(5),h=i(f),d=n(8),_=i(d),y=n(7),p=i(y),v=n(0),w=i(v),m=n(1),b=i(m),g=n(10),E=i(g),T=n(16),x=i(T),A=n(11),R=i(A),k=function(e){function t(e,n){a(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Flat",!1,n));return r._started=!1,r._initialized=!1,r._arKitWrapper=null,r._vrFrameData=null,r._deviceOrientationTracker=null,r._deviceOrientation=null,r._devicePosition=null,r._deviceWorldMatrix=null,r._views.push(new _.default(r._fov,r._depthNear,r._depthFar)),r}return u(t,e),l(t,[{key:"_start",value:function(){var e=this;this._reality._vrDisplay?null===this._vrFrameData&&(this._vrFrameData=new VRFrameData,this._views[0]._depthNear=this._reality._vrDisplay.depthNear,this._views[0]._depthFar=this._reality._vrDisplay.depthFar,this._deviceOrientation=new b.default,this._devicePosition=new E.default,this._deviceWorldMatrix=new Float32Array(16)):R.default.HasARKit()?!1===this._initialized?(this._initialized=!0,this._arKitWrapper=R.default.GetOrCreate(),this._arKitWrapper.addEventListener(R.default.INIT_EVENT,this._handleARKitInit.bind(this)),this._arKitWrapper.addEventListener(R.default.WATCH_EVENT,this._handleARKitUpdate.bind(this)),this._arKitWrapper.waitForInit().then(function(){e._arKitWrapper.watch()})):this._arKitWrapper.watch():!1===this._initialized&&(this._initialized=!0,this._deviceOrientation=new b.default,this._devicePosition=new E.default,this._deviceWorldMatrix=new Float32Array(16),this._deviceOrientationTracker=new x.default,this._deviceOrientationTracker.addEventListener(x.default.ORIENTATION_UPDATE_EVENT,this._updateFromDeviceOrientationTracker.bind(this))),this.running=!0,this._reality._start()}},{key:"_stop",value:function(){}},{key:"_handleNewBaseLayer",value:function(e){e._context.canvas.width=window.innerWidth,e._context.canvas.height=window.innerHeight,this._xr._sessionEls.appendChild(e._context.canvas)}},{key:"_handleNewFrame",value:function(e){null!==this._vrFrameData&&this._updateFromVRDevice()}},{key:"_updateFromVRDevice",value:function(){var e,t;this._reality._vrDisplay.getFrameData(this._vrFrameData),this._views[0].setProjectionMatrix(this._vrFrameData.leftProjectionMatrix),(e=this._deviceOrientation).set.apply(e,o(this._vrFrameData.pose.orientation)),(t=this._devicePosition).set.apply(t,o(this._vrFrameData.pose.position)),this._devicePosition.add(0,XRViewPose.SITTING_EYE_HEIGHT,0),w.default.mat4_fromRotationTranslation(this._deviceWorldMatrix,this._deviceOrientation.toArray(),this._devicePosition.toArray()),this._headPose._setPoseModelMatrix(this._deviceWorldMatrix),this._eyeLevelPose._position=this._devicePosition.toArray()}},{key:"_updateFromDeviceOrientationTracker",value:function(){this._deviceOrientationTracker.getOrientation(this._deviceOrientation),this._devicePosition.set(this._headPose.poseModelMatrix[12],this._headPose.poseModelMatrix[13],this._headPose.poseModelMatrix[14]),this._devicePosition.add(0,XRViewPose.SITTING_EYE_HEIGHT,0),w.default.mat4_fromRotationTranslation(this._deviceWorldMatrix,this._deviceOrientation.toArray(),this._devicePosition.toArray()),this._headPose._setPoseModelMatrix(this._deviceWorldMatrix),this._eyeLevelPose._position=this._devicePosition.toArray()}},{key:"_handleARKitUpdate",value:function(){var e=this._arKitWrapper.getData("camera_transform");e?(this._headPose._setPoseModelMatrix(e),this._headPose._poseModelMatrix[13]+=XRViewPose.SITTING_EYE_HEIGHT,this._eyeLevelPose._position=this._headPose._position):console.log("no camera transform",this._arKitWrapper.rawARData);var t=this._arKitWrapper.getData("projection_camera");t?this._views[0].setProjectionMatrix(t):console.log("no projection camera",this._arKitWrapper.rawARData)}},{key:"_handleARKitInit",value:function(e){var t=this;setTimeout(function(){t._arKitWrapper.watch({location:!0,camera:!0,objects:!0,light_intensity:!0})},1e3)}},{key:"_createSession",value:function(e){return this._start(),c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createSession",this).call(this,e)}},{key:"_supportedCreationParameters",value:function(e){return e.type===p.default.AUGMENTATION&&!1===e.exclusive}}]),t}(h.default);t.default=k},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t,n,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.DefaultOrder;r(this,e),this.x=t,this.y=n,this.z=i,this.order=o}return i(e,[{key:"set",value:function(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.DefaultOrder;this.x=t,this.y=n,this.z=r,this.order=i}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}}]),e}();t.default=o,o.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],o.DefaultOrder="XYZ"},function(e,t,n){function i(e){return e&&e.__esModule?e:{default:e}}function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(5),f=i(c),h=n(8),d=i(h),_=n(7),y=i(_),p=n(9),v=(i(p),n(0)),w=i(v),m=n(1),b=i(m),g=n(10),E=i(g),T=n(16),x=(i(T),n(11)),A=(i(x),function(e){function t(e,n,r){a(this,t);var i=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r.displayName,r.capabilities.hasExternalDisplay,n));return i._vrDisplay=r,i._vrFrameData=new VRFrameData,i._leftView=new d.default(i._fov,i._depthNear,i._depthFar,d.default.LEFT),i._rightView=new d.default(i._fov,i._depthNear,i._depthFar,d.default.RIGHT),i._views=[i._leftView,i._rightView],i._deviceOrientation=new b.default,i._devicePosition=new E.default,i._deviceWorldMatrix=new Float32Array(16),i}return u(t,e),l(t,[{key:"_requestAnimationFrame",value:function(e){this._vrDisplay.isPresenting?this._vrDisplay.requestAnimationFrame(e):window.requestAnimationFrame(e)}},{key:"_handleNewBaseLayer",value:function(e){var t=this;this._vrDisplay.requestPresent([{source:e._context.canvas}]).then(function(){var n=t._vrDisplay.getEyeParameters("left"),r=t._vrDisplay.getEyeParameters("right");e._context.canvas.width=2*Math.max(n.renderWidth,r.renderWidth),e._context.canvas.height=Math.max(n.renderHeight,r.renderHeight),e._context.canvas.style.position="absolute",e._context.canvas.style.bottom="1px",e._context.canvas.style.right="1px",document.body.appendChild(e._context.canvas)}).catch(function(e){console.error("Unable to init WebVR 1.1 display",e)})}},{key:"_handleNewFrame",value:function(e){this._vrDisplay.isPresenting&&this._updateFromVRFrameData()}},{key:"_handleAfterFrame",value:function(e){this._vrDisplay.isPresenting&&this._vrDisplay.submitFrame()}},{key:"_supportedCreationParameters",value:function(e){return e.type===y.default.REALITY&&!0===e.exclusive}},{key:"_updateFromVRFrameData",value:function(){if(this._vrDisplay.getFrameData(this._vrFrameData),this._leftView.setProjectionMatrix(this._vrFrameData.leftProjectionMatrix),this._rightView.setProjectionMatrix(this._vrFrameData.rightProjectionMatrix),this._vrFrameData.pose){if(this._vrFrameData.pose.orientation){var e;(e=this._deviceOrientation).set.apply(e,o(this._vrFrameData.pose.orientation))}if(this._vrFrameData.pose.position){var t;(t=this._devicePosition).set.apply(t,o(this._vrFrameData.pose.position))}w.default.mat4_fromRotationTranslation(this._deviceWorldMatrix,this._deviceOrientation.toArray(),this._devicePosition.toArray()),this._vrDisplay.stageParameters&&this._vrDisplay.stageParameters.sittingToStandingTransform&&w.default.mat4_multiply(this._deviceWorldMatrix,this._vrDisplay.stageParameters.sittingToStandingTransform,this._deviceWorldMatrix),this._headPose._setPoseModelMatrix(this._deviceWorldMatrix),this._eyeLevelPose.position=this._devicePosition.toArray()}}}]),t}(f.default));t.default=A},function(e,t,n){function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":r(t))&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(6),c=i(l),f=n(3),h=i(f),d=n(9),_=i(d),y=n(4),p=i(y),v=n(12),w=i(v),m=n(0),b=i(m),g=n(1),E=i(g),T=n(11),x=i(T),A=n(33),R=i(A),k=function(e){function t(e){o(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"Camera",!0,!0));return n._initialized=!1,n._running=!1,n._arKitWrapper=null,n._mediaStream=null,n._videoEl=null,n._arCoreCameraRenderer=null,n._arCoreCanvas=null,n._elContext=null,n._vrDisplay=null,n._vrFrameData=null,"function"==typeof navigator.getVRDisplays&&navigator.getVRDisplays().then(function(e){var t=!0,r=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var s=o.value;if(null!==s&&s.capabilities.hasPassThroughCamera){if(n._vrDisplay=s,n._vrFrameData=new VRFrameData,n._arCoreCanvas=document.createElement("canvas"),n._xr._realityEls.appendChild(n._arCoreCanvas),n._arCoreCanvas.width=window.innerWidth,n._arCoreCanvas.height=window.innerHeight,n._elContext=n._arCoreCanvas.getContext("webgl"),null===n._elContext)throw"Could not create CameraReality GL context";window.addEventListener("resize",function(){n._arCoreCanvas.width=window.innerWidth,n._arCoreCanvas.height=window.innerHeight},!1);break}}}catch(e){r=!0,i=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw i}}}),n}return s(t,e),u(t,[{key:"_handleNewFrame",value:function(e){this._arCoreCameraRenderer&&(this._arCoreCameraRenderer.render(),this._vrDisplay.getFrameData(this._vrFrameData))}},{key:"_start",value:function(){var e=this;this._running||(this._running=!0,null!==this._vrDisplay?(this._arCoreCameraRenderer=new R.default(this._vrDisplay,this._elContext),this._initialized=!0):x.default.HasARKit()?!1===this._initialized?(this._initialized=!0,this._arKitWrapper=x.default.GetOrCreate(),this._arKitWrapper.addEventListener(x.default.WATCH_EVENT,this._handleARKitWatch.bind(this)),this._arKitWrapper.waitForInit().then(function(){e._arKitWrapper.watch()})):this._arKitWrapper.watch():!1===this._initialized?(this._initialized=!0,navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment"}}).then(function(t){e._videoEl=document.createElement("video"),e._xr._realityEls.appendChild(e._videoEl),e._videoEl.setAttribute("class","camera-reality-video"),e._videoEl.setAttribute("playsinline",!0),e._videoEl.style.width="100%",e._videoEl.style.height="100%",e._videoEl.srcObject=t,e._videoEl.play()}).catch(function(t){console.error("Could not set up video stream",t),e._initialized=!1,e._running=!1})):this._videoEl.play())}},{key:"_stop",value:function(){if(x.default.HasARKit()){if(null===this._arKitWrapper)return;this._arKitWrapper.stop()}else null!==this._videoEl&&this._videoEl.pause()}},{key:"_handleARKitWatch",value:function(e){if(e.detail&&e.detail.objects){var t=!0,n=!1,r=void 0;try{for(var i,o=e.detail.objects[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;this._updateAnchorFromARKitUpdate(a.uuid,a)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}}},{key:"_handleARKitAddObject",value:function(e){this._updateAnchorFromARKitUpdate(e.uuid,e)}},{key:"_updateAnchorFromARKitUpdate",value:function(e,t){var n=this._anchors.get(e)||null;if(null===n)return void console.log("unknown anchor",n);n.coordinates.poseMatrix=t.transform}},{key:"_addAnchor",value:function(e,t){var n=this;return e.coordinates=e.coordinates.getTransformedCoordinates(t._trackerCoordinateSystem),null!==this._arKitWrapper&&this._arKitWrapper.addAnchor(e.uid,e.coordinates.poseMatrix).then(function(e){return n._handleARKitAddObject(e)}),this._anchors.set(e.uid,e),e.uid}},{key:"_findAnchor",value:function(e,t,n){var r=this;return new Promise(function(i,o){if(null!==r._arKitWrapper)r._arKitWrapper.hitTest(e,t,x.default.HIT_TEST_TYPE_EXISTING_PLANES).then(function(e){if(0===e.length)return i(null),void console.log("miss");var t=r._pickARKitHit(e);t.anchor_transform[13]+=_.default.SITTING_EYE_HEIGHT,t.world_transform[13]+=_.default.SITTING_EYE_HEIGHT;var o=r._getAnchor(t.uuid);if(null===o){var a=new p.default(n,n._trackerCoordinateSystem);a.poseMatrix=t.anchor_transform,o=new h.default(a,t.uuid),r._anchors.set(o.uid,o)}var s=[t.world_transform[12]-t.anchor_transform[12],t.world_transform[13]-t.anchor_transform[13],t.world_transform[14]-t.anchor_transform[14]],u=(new E.default).setFromRotationMatrix(t.world_transform),l=(new E.default).setFromRotationMatrix(t.anchor_transform).inverse(),c=(new E.default).multiplyQuaternions(u,l),f=new w.default(o.uid);f.poseMatrix=b.default.mat4_fromRotationTranslation(new Float32Array(16),c.toArray(),s),i(f)});else if(null!==r._vrDisplay){var a=r._vrDisplay.hitTest(e,t);if(0==a.length)return void i(null);a.sort(function(e,t){return e.distance-t.distance});var s=r._getAnchor(a[0].uuid);if(null===s){var u=new p.default(n,n._trackerCoordinateSystem);u.poseMatrix=a[0].modelMatrix,u._poseMatrix[13]+=_.default.SITTING_EYE_HEIGHT,s=new h.default(u),r._anchors.set(s.uid,s)}i(new w.default(s.uid))}else i(null)})}},{key:"_removeAnchor",value:function(e){this._anchors.delete(e)}},{key:"_pickARKitHit",value:function(e){if(0===e.length)return null;var t=null,n=e.filter(function(e){return e.type!=x.default.HIT_TEST_TYPE_FEATURE_POINT}),r=n.filter(function(e){return e.type==x.default.HIT_TEST_TYPE_EXISTING_PLANE_USING_EXTENT}),i=n.filter(function(e){return e.type==x.default.HIT_TEST_TYPE_EXISTING_PLANE});return r.length?(r=r.sort(function(e,t){return e.distance-t.distance}),t=r[0]):i.length?(i=i.sort(function(e,t){return e.distance-t.distance}),t=i[0]):n.length?(n=n.sort(function(e,t){return e.distance-t.distance}),t=n[0]):t=e[0],t}}]),t}(c.default);t.default=k},function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,n){if("fragment"==n)var r=e.createShader(e.FRAGMENT_SHADER);else{if("vertex"!=n)return null;var r=e.createShader(e.VERTEX_SHADER)}return e.shaderSource(r,t),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)?r:(console.error(e.getShaderInfoLog(r)),null)}function o(e,t,n){var r=i(e,t,"vertex"),o=i(e,n,"fragment");if(!o)return null;var a=e.createProgram();return e.attachShader(a,r),e.attachShader(a,o),e.linkProgram(a),e.getProgramParameter(a,e.LINK_STATUS)||console.error("Could not initialise arview shaders"),a}function a(e,t){var n=0;switch(t){case 90:n=1;break;case 180:n=2;break;case 270:n=3;break;default:n=0}var r=0;switch(e){case 90:r=1;break;case 180:r=2;break;case 270:r=3;break;default:r=0}var i=r-n;return i<0&&(i+=4),i%4}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u="#extension GL_OES_EGL_image_external : require\n\nprecision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform samplerExternalOES uSampler;\n\nvoid main(void) {\n  gl_FragColor = texture2D(uSampler, vTextureCoord);\n}",l="attribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void) {\n  gl_Position = vec4(aVertexPosition, 1.0);\n  vTextureCoord = aTextureCoord;\n}",c=function(){function e(t,n){r(this,e),this.vrDisplay=t,this.gl=n,this.passThroughCamera=t.getPassThroughCamera(),this.program=o(n,l,u),n.useProgram(this.program),this.vertexPositionAttribute=n.getAttribLocation(this.program,"aVertexPosition"),this.textureCoordAttribute=n.getAttribLocation(this.program,"aTextureCoord"),this.samplerUniform=n.getUniformLocation(this.program,"uSampler"),this.vertexPositionBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.vertexPositionBuffer);var i=[-1,1,0,-1,-1,0,1,1,0,1,-1,0],s=new Float32Array(i);n.bufferData(n.ARRAY_BUFFER,s,n.STATIC_DRAW),this.vertexPositionBuffer.itemSize=3,this.vertexPositionBuffer.numItems=12,this.textureCoordBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.textureCoordBuffer);var c=null;if(this.vrDisplay){var f=this.passThroughCamera.width/this.passThroughCamera.textureWidth,h=this.passThroughCamera.height/this.passThroughCamera.textureHeight;c=[[0,0,0,h,f,0,f,h],[f,0,0,0,f,h,0,h],[f,h,f,0,0,h,0,0],[0,h,f,h,0,0,f,0]]}else c=[[0,0,0,1,1,0,1,1],[1,0,0,0,1,1,0,1],[1,1,1,0,0,1,0,0],[0,1,1,1,0,0,1,0]];this.f32TextureCoords=[];for(var d=0;d<c.length;d++)this.f32TextureCoords.push(new Float32Array(c[d]));this.combinedOrientation=a(screen.orientation.angle,this.passThroughCamera.orientation),n.bufferData(n.ARRAY_BUFFER,this.f32TextureCoords[this.combinedOrientation],n.STATIC_DRAW),this.textureCoordBuffer.itemSize=2,this.textureCoordBuffer.numItems=8,n.bindBuffer(n.ARRAY_BUFFER,null),this.indexBuffer=n.createBuffer(),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var _=[0,1,2,2,1,3],y=new Uint16Array(_);return n.bufferData(n.ELEMENT_ARRAY_BUFFER,y,n.STATIC_DRAW),this.indexBuffer.itemSize=1,this.indexBuffer.numItems=6,n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),this.texture=n.createTexture(),n.useProgram(null),this.projectionMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.mvMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this}return s(e,[{key:"render",value:function(){var e=this.gl;e.useProgram(this.program),e.bindBuffer(e.ARRAY_BUFFER,this.vertexPositionBuffer),e.enableVertexAttribArray(this.vertexPositionAttribute),e.vertexAttribPointer(this.vertexPositionAttribute,this.vertexPositionBuffer.itemSize,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.textureCoordBuffer);var t=a(screen.orientation.angle,this.passThroughCamera.orientation);t!==this.combinedOrientation&&(this.combinedOrientation=t,e.bufferData(e.ARRAY_BUFFER,this.f32TextureCoords[this.combinedOrientation],e.STATIC_DRAW)),e.enableVertexAttribArray(this.textureCoordAttribute),e.vertexAttribPointer(this.textureCoordAttribute,this.textureCoordBuffer.itemSize,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_EXTERNAL_OES,this.texture),e.texImage2D(e.TEXTURE_EXTERNAL_OES,0,e.RGB,e.RGB,e.UNSIGNED_BYTE,this.passThroughCamera),e.uniform1i(this.samplerUniform,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.drawElements(e.TRIANGLES,this.indexBuffer.numItems,e.UNSIGNED_SHORT,0),e.bindTexture(e.TEXTURE_EXTERNAL_OES,null),e.disableVertexAttribArray(this.vertexPositionAttribute),e.disableVertexAttribArray(this.textureCoordAttribute),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.useProgram(null)}}]),e}(),f=function(){function e(t,n){r(this,e),this.vrDisplay=t,this.gl=n,this.videoRenderer=new c(t,this.gl),this.width=window.innerWidth,this.height=window.innerHeight,window.addEventListener("resize",this.onWindowResize.bind(this),!1)}return s(e,[{key:"onWindowResize",value:function(){this.width=window.innerWidth,this.height=window.innerHeight}},{key:"render",value:function(){var e=this.gl,t=1*this.width,n=1*this.height;e.viewportWidth!==t&&(e.viewportWidth=t),e.viewportHeight!==n&&(e.viewportHeight=n),this.gl.viewport(0,0,e.viewportWidth,e.viewportHeight),this.videoRenderer.render()}}]),e}();t.default=f}])}]);